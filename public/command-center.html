<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DRX | Command Center</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background-color: #0f172a; color: #e2e8f0; font-family: 'Inter', system-ui, -apple-system, sans-serif; overflow: hidden; }
        
        /* SCROLLBAR */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
        
        /* UI ELEMENTS */
        .glass-panel { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.08); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2); }
        .task-card { transition: transform 0.2s, box-shadow 0.2s; cursor: grab; }
        .task-card:active { cursor: grabbing; }
        .task-card:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.4); z-index: 10; }
        
        .spinner { border: 3px solid rgba(255,255,255,0.1); border-left-color: #3b82f6; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* WHITEBOARD (MIND MAP) STYLES */
        .whiteboard-grid {
            background-color: #0f172a;
            background-image: radial-gradient(#334155 1px, transparent 1px);
            background-size: 24px 24px;
        }
        .wb-obj { position: absolute; transition: box-shadow 0.1s; user-select: none; }
        .wb-obj:hover { outline: 2px solid rgba(59, 130, 246, 0.5); }
        .wb-obj.selected { outline: 2px solid #2563eb; z-index: 50; box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.2); }
        .sticky-note { 
            box-shadow: 3px 3px 8px rgba(0,0,0,0.2); 
            font-family: 'Comic Sans MS', cursive, sans-serif; 
            display: flex; align-items: center; justify-content: center; 
            text-align: center; padding: 12px; overflow: hidden; border-radius: 4px; color: #1e293b;
        }
        .text-obj { background: transparent; border: 1px solid transparent; padding: 4px; }
        .text-obj:hover { border: 1px dashed #cbd5e1; }
        .frame-obj { border: 2px dashed #94a3b8; background: rgba(255,255,255,0.03); pointer-events: none; }
        .frame-obj .frame-label { position: absolute; top: -24px; left: 0; font-size: 12px; color: #94a3b8; font-weight: bold; pointer-events: auto; }
        .cursor-pen { cursor: crosshair; }

        /* ANIMATIONS */
        .animate-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }

        /* MODAL */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(4px); z-index: 100; display: flex; align-items: center; justify-content: center; padding: 1rem; }
        .btn-primary { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); transition: all 0.2s; }
        .btn-primary:hover { background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); transform: translateY(-1px); box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4); }
    </style>
</head>
<body class="dark">
    <div id="root" class="h-screen w-screen"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- CONFIGURA√á√ÉO FIREBASE ---
        const firebaseConfig = {
          apiKey: "AIzaSyDylH6geJHzs1xZBhxZ7fnBLEbeKopB9nA",
          authDomain: "calendario-post-3faec.firebaseapp.com",
          projectId: "calendario-post-3faec",
          storageBucket: "calendario-post-3faec.firebasestorage.app",
          messagingSenderId: "677302847639",
          appId: "1:677302847639:web:08370d758ab1d7ebf081d2",
          measurementId: "G-3XCRGNQQSY"
        };

        let auth, db;
        try {
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }
            auth = firebase.auth();
            db = firebase.firestore();
        } catch (e) {
            console.error("Erro Firebase Init:", e);
        }
        
        const COLLECTION_NAME = "drx_tasks_v1";
        const EXPERTS_COLLECTION = "drx_experts_v1";
        const MINDMAP_COLLECTION = "drx_mindmaps_v1";

        // --- CONSTANTES ---
        const VIDEO_PACKS = [
            { name: "AERONAVES", url: "https://drive.google.com/drive/folders/189oEaZQcqc5mLsWSjpXMawNmoe3lmU24?usp=drive_link", icon: "plane" },
            { name: "CARROS LUXO", url: "https://drive.google.com/drive/folders/1QL8ht2tBe6nL_2-6XFTmtJAjN9nmB4qA?usp=drive_link", icon: "car" },
            { name: "CORTES PRONTOS", url: "https://drive.google.com/drive/folders/1eoW5Ar4B4gspatezHdV2eI0G2AJEZzt4?usp=drive_link", icon: "scissors" },
            { name: "MONEY", url: "https://drive.google.com/drive/folders/1qrMxmDxS1p6FnuQDAGW1kDCmKoIlgbR6?usp=drive_link", icon: "dollar-sign" },
            { name: "FEMININO", url: "https://drive.google.com/drive/folders/18HtVEZFGxzWOQmNSRhjtElJpZfFOAZE3?usp=drive_link", icon: "user" },
            { name: "FILMES E S√âRIES", url: "https://drive.google.com/drive/folders/1lZnexU1KrY4Ev0QfVwGhfppdQbZX_CBy?usp=drive_link", icon: "film" },
            { name: "LIFESTYLE", url: "https://drive.google.com/drive/folders/1puA0S1x1hMYqiBp6TbakjvAaPzDrl0eI?usp=drive_link", icon: "coffee" },
            { name: "LIFESTYLE CASAIS", url: "https://drive.google.com/drive/folders/1VOIsOTkwojahAp1_tJ1e39cYW10rZBgB?usp=drive_link", icon: "heart" },
            { name: "MANS√ïES LUXO", url: "https://drive.google.com/drive/folders/1gL58gw01ye-CnWUa_rl0RpeiGhk4Vx0q?usp=drive_link", icon: "home" },
            { name: "MAR", url: "https://drive.google.com/drive/folders/1JxzWEVNnEXSYE5DJeQD87e-D743NlaMR?usp=drive_link", icon: "anchor" },
            { name: "MOTIV. & FOCO", url: "https://drive.google.com/drive/folders/1ZDIZrdle5mLUpAOOMAbv3JJk2mhAPpFb?usp=drive_link", icon: "target" },
            { name: "MOTOCROSS", url: "https://drive.google.com/drive/folders/1KmWx3jjxK62updPjCl6ca2GiKDFfKlwA?usp=drive_link", icon: "bike" },
            { name: "MOTOS", url: "https://drive.google.com/drive/folders/1HWMSOX-wajT3AkxEZka-N4-7KqNqrHQF?usp=drive_link", icon: "zap" },
            { name: "PAISAGENS & VISTAS", url: "https://drive.google.com/drive/folders/18XfVpxZN0bxkrPvyWAX9vrXIGCsGiRyb?usp=drive_link", icon: "mountain" },
            { name: "REL√ìGIOS", url: "https://drive.google.com/drive/folders/1KhblqSRwbXlB8ANs3QpXJb5-ATodYAdw?usp=drive_link", icon: "watch" },
            { name: "SNOWBOARD", url: "https://drive.google.com/drive/folders/1IqgS5b1wXrNnEWZIY_6tq4pkdcYmSUPJ?usp=drive_link", icon: "snowflake" },
            { name: "VARIADOS", url: "https://drive.google.com/drive/folders/1j_GxDwIrmdN-UBoUrPZZf_Js6EI6I7iD?usp=drive_link", icon: "grid" },
        ];

        const TEAM = {
            'bruno': { name: 'Bruno Brites', role: 'Social Media', color: 'bg-blue-600', text: 'text-blue-100', initials: 'BB' },
            'victor': { name: 'Victor Navega', role: 'Editor', color: 'bg-purple-600', text: 'text-purple-100', initials: 'VN' },
            'pedro': { name: 'Pedro Cavassis', role: 'Designer', color: 'bg-pink-600', text: 'text-pink-100', initials: 'PC' },
            'danillo': { name: 'Danillo Sousa', role: 'Head Ops', color: 'bg-green-600', text: 'text-green-100', initials: 'DS' },
            'gabriel': { name: 'Gabriel Freitas', role: 'Creator', color: 'bg-yellow-600', text: 'text-yellow-100', initials: 'GF' }
        };

        const COLUMNS = [
            { id: 'backlog', title: 'Ideia / Roteiro', color: 'border-slate-500' },
            { id: 'production', title: 'Em Produ√ß√£o', color: 'border-yellow-500' },
            { id: 'editing', title: 'Edi√ß√£o / Design', color: 'border-purple-500' },
            { id: 'review', title: 'Revis√£o (Ops)', color: 'border-green-500' },
            { id: 'scheduled', title: 'Agendado', color: 'border-blue-500' },
            { id: 'posted', title: 'Postado', color: 'border-slate-700' }
        ];

        const TYPES = {
            'reels': { label: 'Reels', icon: 'film', color: 'text-purple-400 border-purple-500/50 bg-purple-500/10' },
            'youtube': { label: 'YouTube', icon: 'youtube', color: 'text-red-500 border-red-500/50 bg-red-500/10' },
            'carrossel': { label: 'Carrossel', icon: 'images', color: 'text-blue-400 border-blue-500/50 bg-blue-500/10' },
            'dump': { label: 'Photo Dump', icon: 'camera', color: 'text-green-400 border-green-500/50 bg-green-500/10' },
            'teste': { label: 'Teste Criativo', icon: 'flask-conical', color: 'text-yellow-400 border-yellow-500/50 bg-yellow-500/10' }
        };

        const PAUTA_TYPES = {
            'fria': { label: 'Pauta Fria', color: 'text-blue-400', border: 'border-blue-500', bg: 'bg-blue-500' },
            'quente': { label: 'Pauta Quente', color: 'text-orange-500', border: 'border-orange-500', bg: 'bg-orange-500' },
            'urgente': { label: 'Pauta Urgente', color: 'text-red-500', border: 'border-red-600', bg: 'bg-red-600' }
        };

        const REELS_FORMATS = [
            { id: 'pov', label: 'POV (Point of View)' },
            { id: 'video_falado', label: 'V√≠deo Falado / Conte√∫do' },
            { id: 'caixinha', label: 'Caixinha de Perguntas' },
            { id: 'trend', label: 'Trend / Viral' }
        ];

        const DEFAULT_EXPERTS = ['Pedro Cavassis', 'Arthur C√©sar', 'Brandon Cantu√°ria', 'DRX'];

        const getTaskType = (type) => TYPES[type] || TYPES['reels'];
        const formatDateShort = (dateStr) => {
            if (!dateStr) return '--/--';
            const parts = dateStr.split('-');
            if (parts.length === 3) return `${parts[2]}/${parts[1]}`;
            return '--/--';
        };

        // --- COMPONENTE ICON ---
        const Icon = ({ name, className, ...props }) => {
            const ref = useRef(null);
            useEffect(() => {
                if (ref.current && window.lucide) {
                    const i = document.createElement('i');
                    i.setAttribute('data-lucide', name);
                    if (className) i.className = className;
                    ref.current.innerHTML = '';
                    ref.current.appendChild(i);
                    try { window.lucide.createIcons({ root: ref.current, nameAttr: 'data-lucide' }); } catch (e) {}
                }
            }, [name, className]); 
            return <span ref={ref} style={{ display: 'inline-flex', alignItems: 'center' }} {...props}></span>;
        };

        // --- VIEW: WORKFLOW AI (VSL) ---
        function WorkflowView() {
            const [step, setStep] = useState(1);
            const [productData, setProductData] = useState({ niche: '', product: '', target: '' });
            const [generatedScenes, setGeneratedScenes] = useState([]);
            const [isGenerating, setIsGenerating] = useState(false);
            const [copied, setCopied] = useState(null);

            const handleGeneratePrompts = () => {
                if(!productData.product) return alert("‚ùå Preencha o nome do produto!");
                setIsGenerating(true);
                setTimeout(() => {
                    const mockScenes = [
                        { id: 1, text: "Close-up cinematogr√°fico do produto flutuando em gravidade zero, ilumina√ß√£o dram√°tica.", status: 'pending' },
                        { id: 2, text: "Pessoa usando o produto em um ambiente luxuoso e moderno, sorriso natural e confiante.", status: 'pending' },
                        { id: 3, text: "Explos√£o de part√≠culas douradas e brilhantes revelando a logo da marca em 3D.", status: 'pending' },
                        { id: 4, text: "Drone view a√©reo de uma paisagem urbana futurista ao entardecer com o produto em destaque.", status: 'pending' },
                        { id: 5, text: "Transi√ß√£o r√°pida mostrando benef√≠cios do produto com motion graphics elegante.", status: 'pending' }
                    ];
                    setGeneratedScenes(mockScenes);
                    setIsGenerating(false);
                    setStep(2);
                }, 2000);
            };

            const copyPrompt = (text, id) => {
                const prompt = `Hyper-realistic cinematic shot, 8k HDR, professional color grading: ${text} --ar 9:16 --style raw --q 2`;
                navigator.clipboard.writeText(prompt);
                setCopied(id);
                setTimeout(() => setCopied(null), 2000);
            };

            return (
                <div className="h-full flex flex-col p-6 overflow-y-auto">
                    <div className="max-w-5xl mx-auto w-full">
                        <div className="text-center mb-8">
                            <h2 className="text-4xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-yellow-400 via-orange-500 to-red-500 mb-2">üé¨ VSL Factory AI</h2>
                            <p className="text-slate-400">Workflow: Conceito ‚Üí Freepik/Nano ‚Üí Kling AI ‚Üí Topaz ‚Üí CapCut</p>
                        </div>
                        
                        <div className="flex justify-between mb-10 relative max-w-2xl mx-auto">
                            <div className="absolute top-1/2 left-0 w-full h-1 bg-slate-700 -z-10 rounded transform -translate-y-1/2"></div>
                            {[{num:1, l:'Conceito'}, {num:2, l:'Prompts'}, {num:3, l:'Anima√ß√£o'}, {num:4, l:'Edi√ß√£o'}].map(s => (
                                <div key={s.num} className="flex flex-col items-center">
                                    <div className={`w-12 h-12 rounded-full flex items-center justify-center font-bold border-4 transition-all ${step >= s.num ? 'bg-blue-600 border-blue-900 text-white' : 'bg-slate-800 border-slate-700 text-slate-500'}`}>{s.num}</div>
                                    <span className="text-xs text-slate-500 mt-2">{s.l}</span>
                                </div>
                            ))}
                        </div>

                        {step === 1 && (
                            <div className="glass-panel p-8 rounded-2xl animate-in">
                                <h3 className="text-2xl font-bold text-white mb-6 flex gap-2"><Icon name="target" className="w-6 h-6 text-blue-400"/> Defini√ß√£o do Conceito</h3>
                                <div className="space-y-5">
                                    <div><label className="text-sm font-bold text-slate-300 block mb-2">Nicho</label><input className="w-full bg-slate-900 border border-slate-700 rounded-lg p-3 text-white" value={productData.niche} onChange={e=>setProductData({...productData, niche: e.target.value})} placeholder="Ex: Est√©tica Automotiva" /></div>
                                    <div><label className="text-sm font-bold text-slate-300 block mb-2">Produto</label><input className="w-full bg-slate-900 border border-slate-700 rounded-lg p-3 text-white" value={productData.product} onChange={e=>setProductData({...productData, product: e.target.value})} placeholder="Ex: Cera Premium" /></div>
                                    <div><label className="text-sm font-bold text-slate-300 block mb-2">P√∫blico & Vibe</label><textarea className="w-full bg-slate-900 border border-slate-700 rounded-lg p-3 text-white h-24" value={productData.target} onChange={e=>setProductData({...productData, target: e.target.value})} placeholder="Homens, 25-45 anos. Vibe dark, luxuosa, cinematogr√°fica." /></div>
                                </div>
                                <button onClick={handleGeneratePrompts} disabled={isGenerating} className="mt-8 px-8 py-4 btn-primary text-white font-bold rounded-xl w-full flex items-center justify-center gap-3 disabled:opacity-50">
                                    {isGenerating ? <><div className="spinner"></div> Gerando...</> : <><Icon name="wand-2" className="w-5 h-5"/> Gerar Roteiro com IA</>}
                                </button>
                            </div>
                        )}

                        {step === 2 && (
                            <div className="glass-panel p-8 rounded-2xl animate-in">
                                <h3 className="text-2xl font-bold text-white mb-6 flex gap-2"><Icon name="sparkles" className="w-6 h-6 text-purple-400"/> Prompts Gerados</h3>
                                <div className="space-y-4 mb-8">
                                    {generatedScenes.map((scene, idx) => (
                                        <div key={scene.id} className="bg-slate-800/50 p-5 rounded-xl border border-slate-700 flex gap-4">
                                            <div className="flex-1">
                                                <div className="flex items-center gap-2 mb-2"><span className="text-xs font-bold text-blue-400 bg-blue-500/10 px-2 py-1 rounded">Cena {idx + 1}</span></div>
                                                <p className="text-slate-300 text-sm">{scene.text}</p>
                                            </div>
                                            <button onClick={()=>copyPrompt(scene.text, scene.id)} className="p-3 bg-blue-600 hover:bg-blue-500 rounded-lg"><Icon name={copied === scene.id ? "check" : "copy"} className="w-5 h-5 text-white" /></button>
                                        </div>
                                    ))}
                                </div>
                                <div className="flex justify-between pt-6 border-t border-slate-700">
                                    <button onClick={()=>setStep(1)} className="text-slate-400 hover:text-white flex gap-2"><Icon name="arrow-left" className="w-4 h-4"/> Voltar</button>
                                    <button onClick={()=>setStep(3)} className="bg-blue-600 hover:bg-blue-500 text-white px-6 py-3 rounded-lg font-bold flex gap-2">Pr√≥ximo <Icon name="arrow-right" className="w-4 h-4"/></button>
                                </div>
                            </div>
                        )}
                        
                        {(step === 3 || step === 4) && (
                            <div className="glass-panel p-8 rounded-2xl text-center animate-in">
                                <div className="w-16 h-16 rounded-full bg-green-500 flex items-center justify-center mx-auto mb-6"><Icon name="check" className="w-8 h-8 text-white"/></div>
                                <h3 className="text-2xl font-bold text-white mb-4">Pr√≥ximos Passos</h3>
                                <div className="grid md:grid-cols-2 gap-4 max-w-2xl mx-auto mb-8">
                                    <a href="https://kling.kuaishou.com/" target="_blank" className="bg-slate-800 p-6 rounded-xl border border-slate-700 hover:border-purple-500 transition block"><div className="text-3xl mb-2">üé¨</div><h4 className="font-bold text-white">Animar no Kling AI</h4><p className="text-sm text-slate-400">Image to Video (Motion 5.0)</p></a>
                                    <div className="bg-slate-800 p-6 rounded-xl border border-slate-700"><div className="text-3xl mb-2">‚ú®</div><h4 className="font-bold text-white">Upscale (Topaz)</h4><p className="text-sm text-slate-400">Melhorar para 4K 60fps</p></div>
                                </div>
                                <button onClick={()=>{setStep(1); setProductData({niche:'',product:'',target:''}); setGeneratedScenes([]);}} className="bg-blue-600 hover:bg-blue-500 text-white px-8 py-3 rounded-lg font-bold flex items-center gap-2 mx-auto"><Icon name="refresh-cw" className="w-4 h-4"/> Nova VSL</button>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // --- VIEW: MIND MAP AVAN√áADO (MIRO STYLE) ---
        function MindMapView() {
            const [maps, setMaps] = useState([]);
            const [currentMap, setCurrentMap] = useState(null);
            const [nodes, setNodes] = useState([]);
            const [view, setView] = useState({ x: 0, y: 0, scale: 1 });
            const [activeTool, setActiveTool] = useState('cursor');
            const [selectedId, setSelectedId] = useState(null);
            const [isDraggingCanvas, setIsDraggingCanvas] = useState(false);
            const [isDraggingNode, setIsDraggingNode] = useState(false);
            const [dragStart, setDragStart] = useState({x:0, y:0});
            const [dragNodeId, setDragNodeId] = useState(null);
            const [loadingMap, setLoadingMap] = useState(false);

            // Carregar Mapas
            useEffect(() => {
                if(db) {
                    const unsubscribe = db.collection(MINDMAP_COLLECTION).orderBy('createdAt', 'desc').onSnapshot(snap => {
                        setMaps(snap.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                    });
                    return () => unsubscribe();
                }
            }, []);

            // Salvar N√≥s (Auto-Save)
            useEffect(() => {
                if (!currentMap || loadingMap || !db) return;
                const timer = setTimeout(() => {
                    db.collection(MINDMAP_COLLECTION).doc(currentMap.id).update({ nodes, updatedAt: new Date().toISOString() });
                }, 1000);
                return () => clearTimeout(timer);
            }, [nodes, currentMap]);

            // CRUD Mapas
            const createNewMap = async () => {
                const name = prompt("Nome do novo Quadro:");
                if (!name) return;
                setLoadingMap(true);
                try {
                    const newMap = { name, createdAt: new Date().toISOString(), nodes: [] };
                    const docRef = await db.collection(MINDMAP_COLLECTION).add(newMap);
                    openMap({ id: docRef.id, ...newMap });
                } catch (e) { alert("Erro ao criar: " + e.message); } finally { setLoadingMap(false); }
            };

            const openMap = (map) => {
                setLoadingMap(true);
                setCurrentMap(map);
                setNodes(map.nodes || []);
                setView({ x: window.innerWidth/2 - 200, y: window.innerHeight/2 - 200, scale: 1 });
                setLoadingMap(false);
            };

            const deleteMap = async (e, id) => {
                e.stopPropagation();
                if(confirm("Excluir este quadro permanentemente?")) {
                    await db.collection(MINDMAP_COLLECTION).doc(id).delete();
                }
            };
            
            const duplicateMap = async (e, map) => {
                e.stopPropagation();
                if(confirm("Duplicar este quadro?")) {
                    const {id, ...data} = map;
                    await db.collection(MINDMAP_COLLECTION).add({...data, name: data.name + " (C√≥pia)", createdAt: new Date().toISOString()});
                }
            };

            // Canvas Logic
            const createObject = (type, x, y) => {
                const id = Math.random().toString(36).substr(2, 9);
                let newNode = { id, x, y, type };
                if (type === 'sticky') newNode = { ...newNode, text: '', color: '#fef3c7', width: 200, height: 200 };
                else if (type === 'text') newNode = { ...newNode, text: 'Novo Texto', color: 'transparent', fontSize: 24 };
                else if (type === 'frame') newNode = { ...newNode, text: 'Frame', width: 400, height: 300, zIndex: -1 };
                setNodes(prev => [...prev, newNode]);
                setSelectedId(id);
                setActiveTool('cursor');
            };

            const handleMouseDown = (e) => {
                // Ferramenta Mover Canvas
                if (activeTool === 'cursor' && (e.button === 2 || e.target.classList.contains('whiteboard-grid'))) {
                    setIsDraggingCanvas(true);
                    setDragStart({ x: e.clientX, y: e.clientY, origViewX: view.x, origViewY: view.y });
                    return;
                }
                // Ferramentas de Cria√ß√£o
                if (activeTool !== 'cursor') {
                    const x = (e.clientX - view.x) / view.scale;
                    const y = (e.clientY - view.y) / view.scale;
                    createObject(activeTool, x, y);
                    return;
                }
                // Selecionar N√≥
                const target = e.target.closest('.wb-obj');
                if (target) {
                    const id = target.dataset.id;
                    setSelectedId(id);
                    const node = nodes.find(n => n.id === id);
                    setDragNodeId(id);
                    setIsDraggingNode(true);
                    setDragStart({ x: e.clientX, y: e.clientY, origNodeX: node.x, origNodeY: node.y });
                    e.stopPropagation();
                } else {
                    setSelectedId(null);
                }
            };

            const handleMouseMove = (e) => {
                if (isDraggingCanvas) {
                    const dx = e.clientX - dragStart.x;
                    const dy = e.clientY - dragStart.y;
                    setView(prev => ({ ...prev, x: dragStart.origViewX + dx, y: dragStart.origViewY + dy }));
                } else if (isDraggingNode && dragNodeId) {
                    const dx = (e.clientX - dragStart.x) / view.scale;
                    const dy = (e.clientY - dragStart.y) / view.scale;
                    setNodes(prev => prev.map(n => n.id === dragNodeId ? { ...n, x: dragStart.origNodeX + dx, y: dragStart.origNodeY + dy } : n));
                }
            };

            const handleMouseUp = () => {
                setIsDraggingCanvas(false);
                setIsDraggingNode(false);
                setDragNodeId(null);
            };

            const handleWheel = (e) => {
                if (e.ctrlKey || e.metaKey) {
                    e.preventDefault();
                    const scaleAmount = -e.deltaY * 0.001;
                    const newScale = Math.min(Math.max(0.1, view.scale + scaleAmount), 5);
                    setView(prev => ({ ...prev, scale: newScale }));
                } else {
                    setView(prev => ({ ...prev, x: prev.x - e.deltaX, y: prev.y - e.deltaY }));
                }
            };

            const deleteSelected = () => {
                if(selectedId) {
                    setNodes(prev => prev.filter(n => n.id !== selectedId));
                    setSelectedId(null);
                }
            };

            useEffect(() => {
                const handleKey = (e) => { if (e.key === 'Delete' || e.key === 'Backspace') deleteSelected(); };
                window.addEventListener('keydown', handleKey);
                return () => window.removeEventListener('keydown', handleKey);
            }, [selectedId]);

            // LISTA DE MAPAS
            if (!currentMap) {
                return (
                    <div className="flex flex-col items-center justify-center h-full text-white p-6">
                        <div className="bg-slate-900/90 p-10 rounded-3xl border border-slate-700 text-center max-w-4xl w-full shadow-2xl relative overflow-hidden">
                            <h2 className="text-4xl font-bold mb-4 bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-500">Meus Quadros</h2>
                            <button onClick={createNewMap} className="px-8 py-4 btn-primary text-white rounded-xl font-bold mb-8 inline-flex items-center gap-2 shadow-lg hover:scale-105 transition-transform"><Icon name="plus" className="w-5 h-5"/> Criar Novo Quadro</button>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 max-h-[50vh] overflow-y-auto p-2">
                                {maps.map(map => (
                                    <div key={map.id} onClick={() => openMap(map)} className="aspect-video bg-slate-800 rounded-xl p-4 cursor-pointer hover:bg-slate-750 border border-slate-700 hover:border-slate-500 transition-all text-left relative group">
                                        <div className="absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                            <button onClick={(e)=>duplicateMap(e, map)} className="p-1.5 bg-slate-600 hover:bg-slate-500 rounded text-slate-300" title="Duplicar"><Icon name="copy" className="w-4 h-4"/></button>
                                            <button onClick={(e)=>deleteMap(e, map.id)} className="p-1.5 bg-red-900/50 hover:bg-red-900 rounded text-red-300" title="Excluir"><Icon name="trash-2" className="w-4 h-4"/></button>
                                        </div>
                                        <div className="h-full flex flex-col justify-between">
                                            <div><Icon name="layout" className="w-6 h-6 text-blue-400 mb-2"/><h3 className="font-bold text-white line-clamp-2">{map.name}</h3></div>
                                            <span className="text-xs text-slate-500">{new Date(map.createdAt).toLocaleDateString()} ‚Ä¢ {map.nodes?.length || 0} objs</span>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            }

            // CANVAS UI
            return (
                <div className={`w-full h-full relative overflow-hidden whiteboard-grid ${activeTool === 'pen' ? 'cursor-pen' : (activeTool !== 'cursor' ? 'cursor-crosshair' : (isDraggingCanvas ? 'cursor-grabbing' : 'cursor-grab'))}`}
                    onMouseDown={handleMouseDown} onMouseMove={handleMouseMove} onMouseUp={handleMouseUp} onWheel={handleWheel} onContextMenu={e=>e.preventDefault()}>
                    
                    {/* Toolbar */}
                    <div className="absolute top-4 left-1/2 -translate-x-1/2 z-50 bg-slate-800/90 backdrop-blur border border-slate-600 p-1.5 rounded-xl shadow-2xl flex gap-1">
                        <button onClick={()=>setActiveTool('cursor')} className={`p-2 rounded ${activeTool==='cursor'?'bg-blue-600':'text-slate-400 hover:bg-slate-700'}`} title="Mover (V)"><Icon name="mouse-pointer-2" className="w-5 h-5"/></button>
                        <div className="w-px bg-slate-600 mx-1"></div>
                        <button onClick={()=>setActiveTool('sticky')} className={`p-2 rounded ${activeTool==='sticky'?'bg-blue-600':'text-slate-400 hover:bg-slate-700'}`} title="Post-it (N)"><Icon name="sticky-note" className="w-5 h-5"/></button>
                        <button onClick={()=>setActiveTool('text')} className={`p-2 rounded ${activeTool==='text'?'bg-blue-600':'text-slate-400 hover:bg-slate-700'}`} title="Texto (T)"><Icon name="type" className="w-5 h-5"/></button>
                        <button onClick={()=>setActiveTool('frame')} className={`p-2 rounded ${activeTool==='frame'?'bg-blue-600':'text-slate-400 hover:bg-slate-700'}`} title="Frame (F)"><Icon name="layout" className="w-5 h-5"/></button>
                        <div className="w-px bg-slate-600 mx-1"></div>
                        <button onClick={deleteSelected} className="p-2 text-red-400 hover:bg-red-900/30 rounded" title="Deletar"><Icon name="trash-2" className="w-5 h-5"/></button>
                    </div>

                    <button onClick={() => setCurrentMap(null)} className="absolute top-4 left-4 z-50 p-2 bg-slate-800 border border-slate-600 rounded-lg text-slate-300 hover:text-white hover:bg-slate-700 shadow-lg"><Icon name="arrow-left" className="w-5 h-5"/></button>

                    <div style={{ transform: `translate(${view.x}px, ${view.y}px) scale(${view.scale})`, transformOrigin: '0 0', width: '100%', height: '100%' }}>
                        {nodes.map(node => (
                            <div key={node.id} data-id={node.id}
                                className={`wb-obj ${selectedId === node.id ? 'selected' : ''} ${node.type === 'sticky' ? 'sticky-note' : (node.type === 'frame' ? 'frame-obj' : 'text-obj')}`}
                                style={{ 
                                    left: node.x, top: node.y, width: node.width, height: node.height, 
                                    backgroundColor: node.color || (node.type==='sticky'?'#fef3c7':'transparent'),
                                    color: node.type==='text' ? '#e2e8f0' : '#1e293b',
                                    fontSize: node.fontSize || 16,
                                    zIndex: node.type==='frame' ? 0 : 1
                                }}>
                                {node.type === 'sticky' ? (
                                    <textarea className="w-full h-full bg-transparent outline-none resize-none text-center" placeholder="Digite..." value={node.text} onChange={e=>setNodes(nodes.map(n=>n.id===node.id?{...n,text:e.target.value}:n))} />
                                ) : node.type === 'frame' ? (
                                    <div className="frame-label">{node.text}</div>
                                ) : (
                                    <input className="bg-transparent outline-none w-full" value={node.text} onChange={e=>setNodes(nodes.map(n=>n.id===node.id?{...n,text:e.target.value}:n))} />
                                )}
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        // --- VIEW: CALENDAR ---
        function CalendarView({ tasks, onTaskClick, onDateClick }) {
            const [currentDate, setCurrentDate] = useState(new Date());
            const daysInMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0).getDate();
            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1).getDay();
            
            const monthName = currentDate.toLocaleDateString('pt-BR', {month:'long', year:'numeric'});

            const cells = [];
            for(let i=0; i<firstDay; i++) cells.push(<div key={`empty-${i}`} className="bg-slate-800/30 border border-slate-800 min-h-[100px]"></div>);
            
            for(let day=1; day<=daysInMonth; day++) {
                const dateStr = `${currentDate.getFullYear()}-${String(currentDate.getMonth()+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
                const dayTasks = tasks.filter(t => t.date === dateStr);
                const isToday = new Date().toDateString() === new Date(dateStr).toDateString();
                
                cells.push(
                    <div key={day} className={`border border-slate-800 bg-slate-900/50 min-h-[100px] p-2 hover:bg-slate-800/80 transition-colors group relative ${isToday ? 'ring-2 ring-blue-500' : ''}`} onClick={()=>onDateClick(dateStr)}>
                        <div className="flex justify-between mb-2">
                            <span className={`font-bold ${isToday ? 'text-blue-400' : 'text-slate-500'}`}>{day}</span>
                            <button className="opacity-0 group-hover:opacity-100 text-slate-400 hover:text-white"><Icon name="plus" className="w-4 h-4"/></button>
                        </div>
                        <div className="flex flex-col gap-1">
                            {dayTasks.map(t => {
                                const typeInfo = TYPES[t.type] || TYPES['reels'];
                                return (
                                    <div key={t.id} onClick={(e)=>{e.stopPropagation();onTaskClick(t)}} className="text-[10px] bg-slate-800 text-slate-200 p-1 rounded border-l-2 border-blue-500 truncate cursor-pointer hover:bg-slate-700" title={t.title}>
                                        {t.title}
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                );
            }

            return (
                <div className="glass-panel h-full flex flex-col p-6 rounded-xl m-4 overflow-hidden">
                    <div className="flex justify-between items-center mb-4">
                        <h2 className="text-2xl font-bold text-white flex gap-2"><Icon name="calendar" className="w-6 h-6 text-blue-400"/> Calend√°rio</h2>
                        <div className="flex gap-2 items-center bg-slate-800 p-1 rounded-lg">
                            <button onClick={()=>setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth()-1, 1))} className="p-2 hover:bg-slate-700 rounded text-white"><Icon name="chevron-left" className="w-5 h-5"/></button>
                            <span className="px-4 font-bold text-white capitalize w-40 text-center">{monthName}</span>
                            <button onClick={()=>setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth()+1, 1))} className="p-2 hover:bg-slate-700 rounded text-white"><Icon name="chevron-right" className="w-5 h-5"/></button>
                        </div>
                    </div>
                    <div className="grid grid-cols-7 bg-slate-800 text-center text-xs font-bold text-slate-400 py-2 rounded-t-lg">
                        <div>DOM</div><div>SEG</div><div>TER</div><div>QUA</div><div>QUI</div><div>SEX</div><div>S√ÅB</div>
                    </div>
                    <div className="grid grid-cols-7 auto-rows-fr flex-1 overflow-y-auto border border-slate-700 rounded-b-lg">
                        {cells}
                    </div>
                </div>
            );
        }

        // --- VIEW: KANBAN ---
        function KanbanView({tasks, onTaskClick, onDropTask, columnSearchTexts, setColumnSearchTexts}) {
            const handleDragStart = (e, taskId) => e.dataTransfer.setData("taskId", taskId);
            const handleDrop = (e, statusId) => {
                const taskId = e.dataTransfer.getData("taskId");
                if(taskId) onDropTask(taskId, statusId);
            };

            return (
                <div className="flex gap-4 overflow-x-auto h-full p-4 items-start">
                    {COLUMNS.map(col => {
                        const searchText = (columnSearchTexts[col.id] || '').toLowerCase();
                        const colTasks = tasks.filter(t => t.status === col.id && t.title.toLowerCase().includes(searchText));
                        return (
                            <div key={col.id} onDragOver={e=>e.preventDefault()} onDrop={(e)=>handleDrop(e, col.id)} 
                                className="min-w-[320px] w-[320px] flex flex-col glass-panel rounded-xl max-h-full border-t-4" style={{borderTopColor: col.color.replace('border-', '')}}>
                                <div className="p-4 bg-slate-800/60 rounded-t-xl border-b border-slate-700 shrink-0">
                                    <div className="flex justify-between items-center mb-3">
                                        <span className="font-bold text-white">{col.title}</span>
                                        <span className="text-xs bg-slate-700 px-2 py-1 rounded-full text-slate-300">{colTasks.length}</span>
                                    </div>
                                    <input type="text" placeholder="Filtrar..." className="w-full bg-slate-900 border border-slate-700 rounded-lg px-3 py-2 text-sm text-white focus:border-blue-500 outline-none"
                                        value={searchText} onChange={(e)=>setColumnSearchTexts({...columnSearchTexts, [col.id]: e.target.value})} />
                                </div>
                                <div className="p-3 flex-1 overflow-y-auto space-y-3 bg-slate-900/20 min-h-0">
                                    {colTasks.map(task => (
                                        <div key={task.id} draggable onDragStart={(e)=>handleDragStart(e, task.id)} onClick={()=>onTaskClick(task)}
                                            className="task-card bg-slate-800 p-4 rounded-lg border border-slate-700 hover:border-slate-500 relative shadow-lg">
                                            <div className={`absolute left-0 top-0 bottom-0 w-1 ${TYPES[task.type]?.color.split(' ')[0].replace('text-','bg-')}`}></div>
                                            <div className="pl-3">
                                                <div className="flex justify-between items-start mb-2">
                                                    <span className={`text-[10px] px-2 py-1 rounded border font-bold uppercase ${TYPES[task.type]?.color}`}>{TYPES[task.type]?.label}</span>
                                                    {task.date && <span className="text-[10px] text-slate-400 flex gap-1"><Icon name="calendar" className="w-3 h-3"/>{formatDateShort(task.date)}</span>}
                                                </div>
                                                <p className="text-sm font-medium text-white line-clamp-2 mb-2">{task.title}</p>
                                                {task.expert && <div className="text-[10px] text-slate-400 uppercase font-bold flex gap-1"><Icon name="user" className="w-3 h-3"/>{task.expert}</div>}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        );
                    })}
                </div>
            );
        }

        // --- MODAL TAREFA (CRIAR/EDITAR) ---
        function TaskModal({onClose, task, experts, onSave, onDelete}) { 
            const [data, setData] = useState(task || { title: '', status: 'backlog', type: 'reels', expert: '' });
            
            return (
                <div className="modal-overlay animate-in" onClick={onClose}>
                    <div className="bg-slate-900 border border-slate-700 rounded-2xl w-full max-w-2xl p-8 relative shadow-2xl" onClick={e=>e.stopPropagation()}>
                        <button onClick={onClose} className="absolute top-6 right-6 text-slate-400 hover:text-white"><Icon name="x" className="w-6 h-6"/></button>
                        <h2 className="text-2xl font-bold text-white mb-6 flex gap-2"><Icon name={data.id ? "edit-3" : "plus-circle"} className="w-6 h-6 text-blue-400"/> {data.id ? 'Editar Tarefa' : 'Nova Tarefa'}</h2>
                        <div className="space-y-4">
                            <div><label className="text-sm font-bold text-slate-400 block mb-1">T√≠tulo</label><input className="w-full bg-slate-800 border border-slate-600 rounded-lg p-3 text-white focus:border-blue-500 outline-none" value={data.title} onChange={e=>setData({...data, title: e.target.value})} autoFocus /></div>
                            <div className="grid grid-cols-2 gap-4">
                                <div><label className="text-sm font-bold text-slate-400 block mb-1">Status</label><select className="w-full bg-slate-800 border border-slate-600 rounded-lg p-3 text-white" value={data.status} onChange={e=>setData({...data, status: e.target.value})}>{COLUMNS.map(c=><option key={c.id} value={c.id}>{c.title}</option>)}</select></div>
                                <div><label className="text-sm font-bold text-slate-400 block mb-1">Tipo</label><select className="w-full bg-slate-800 border border-slate-600 rounded-lg p-3 text-white" value={data.type} onChange={e=>setData({...data, type: e.target.value})}>{Object.entries(TYPES).map(([k,v])=><option key={k} value={k}>{v.label}</option>)}</select></div>
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div><label className="text-sm font-bold text-slate-400 block mb-1">Data</label><input type="date" className="w-full bg-slate-800 border border-slate-600 rounded-lg p-3 text-white" value={data.date || ''} onChange={e=>setData({...data, date: e.target.value})} /></div>
                                <div><label className="text-sm font-bold text-slate-400 block mb-1">Expert</label><select className="w-full bg-slate-800 border border-slate-600 rounded-lg p-3 text-white" value={data.expert || ''} onChange={e=>setData({...data, expert: e.target.value})}><option value="">Selecione...</option>{experts.map(e=><option key={e} value={e}>{e}</option>)}</select></div>
                            </div>
                            <div><label className="text-sm font-bold text-slate-400 block mb-1">Descri√ß√£o</label><textarea className="w-full bg-slate-800 border border-slate-600 rounded-lg p-3 text-white h-24 resize-none" value={data.description || ''} onChange={e=>setData({...data, description: e.target.value})} /></div>
                        </div>
                        <div className="flex justify-between items-center mt-8 pt-6 border-t border-slate-700">
                            {data.id && onDelete ? <button onClick={()=>{if(confirm('Excluir?')) onDelete(data.id)}} className="text-red-400 hover:text-red-300 flex gap-2"><Icon name="trash-2" className="w-4 h-4"/> Excluir</button> : <div></div>}
                            <div className="flex gap-3">
                                <button onClick={onClose} className="px-6 py-2 text-slate-300 hover:bg-slate-800 rounded-lg">Cancelar</button>
                                <button onClick={()=>{if(!data.title) return alert('T√≠tulo obrigat√≥rio'); onSave(data);}} className="px-6 py-2 btn-primary text-white rounded-lg font-bold flex gap-2"><Icon name="save" className="w-4 h-4"/> Salvar</button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // --- APP PRINCIPAL ---
        function App() {
            const [activeView, setActiveView] = useState('kanban');
            const [tasks, setTasks] = useState([]);
            const [experts, setExperts] = useState(DEFAULT_EXPERTS);
            const [selectedTask, setSelectedTask] = useState(null);
            const [showNewTaskModal, setShowNewTaskModal] = useState(false);
            const [columnSearchTexts, setColumnSearchTexts] = useState({});
            const [loading, setLoading] = useState(true);
            const [statusMsg, setStatusMsg] = useState("Iniciando...");
            const [statusColor, setStatusColor] = useState("text-yellow-500");

            // Filtros Globais
            const [filterExpert, setFilterExpert] = useState('');
            const [filterType, setFilterType] = useState('');
            const [filterPauta, setFilterPauta] = useState('');
            const [isPacksModalOpen, setIsPacksModalOpen] = useState(false);

            useEffect(() => {
                const timer = setTimeout(() => { if (window.lucide) window.lucide.createIcons(); }, 50);
                return () => clearTimeout(timer);
            }, [activeView, showNewTaskModal, selectedTask]); 

            useEffect(() => {
                if(auth) {
                    auth.onAuthStateChanged(async (u) => {
                        if (u) { setStatusMsg("Conectado"); setStatusColor("text-green-400"); } 
                        else { await auth.signInAnonymously(); }
                    });
                }
            }, []);

            useEffect(() => {
                if(db) {
                    const unsubscribe = db.collection(COLLECTION_NAME).onSnapshot((snapshot) => {
                        setTasks(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                        setLoading(false);
                    });
                    return () => unsubscribe();
                } else { setLoading(false); }
            }, []);

            const handleSaveTask = async (task) => {
                const payload = { ...task, updatedAt: new Date().toISOString() };
                if(!task.id) { // Nova
                    payload.id = `task-${Date.now()}`;
                    payload.createdAt = new Date().toISOString();
                    if(db) await db.collection(COLLECTION_NAME).doc(payload.id).set(payload);
                    else setTasks([...tasks, payload]);
                } else { // Edi√ß√£o
                    if(db) await db.collection(COLLECTION_NAME).doc(task.id).update(payload);
                    else setTasks(tasks.map(t => t.id === task.id ? payload : t));
                }
                setShowNewTaskModal(false);
                setSelectedTask(null);
            };

            const handleDeleteTask = async (id) => {
                if(db) await db.collection(COLLECTION_NAME).doc(id).delete();
                else setTasks(tasks.filter(t => t.id !== id));
                setSelectedTask(null);
            };

            const handleDropTask = async (id, newStatus) => {
                if(db) await db.collection(COLLECTION_NAME).doc(id).update({status: newStatus});
                else setTasks(tasks.map(t => t.id === id ? {...t, status: newStatus} : t));
            };

            const filteredTasks = tasks.filter(t => 
                (!filterExpert || t.expert === filterExpert) && 
                (!filterType || t.type === filterType) &&
                (!filterPauta || t.pauta === filterPauta)
            );

            if (loading) return <div className="h-screen flex items-center justify-center bg-slate-900 text-white"><div className="spinner"></div></div>;

            return (
                <div className="flex h-screen bg-[#0f172a] overflow-hidden">
                    {/* SIDEBAR (DO BACKUP) */}
                    <aside className="w-20 flex flex-col items-center py-6 bg-slate-900 border-r border-slate-800 z-50 shadow-2xl shrink-0">
                        <div className="mb-10 w-12 h-12 bg-gradient-to-br from-blue-600 to-blue-700 rounded-xl flex items-center justify-center text-white font-bold text-2xl shadow-lg shadow-blue-900/50">D</div>
                        <nav className="flex flex-col gap-3 w-full px-3">
                            <button onClick={()=>setActiveView('kanban')} className={`p-3 rounded-xl transition-all ${activeView==='kanban' ? 'bg-blue-600 text-white shadow-lg' : 'text-slate-400 hover:text-white hover:bg-slate-800'}`} title="Kanban"><Icon name="layout-kanban" className="w-6 h-6" /></button>
                            <button onClick={()=>setActiveView('calendar')} className={`p-3 rounded-xl transition-all ${activeView==='calendar' ? 'bg-blue-600 text-white shadow-lg' : 'text-slate-400 hover:text-white hover:bg-slate-800'}`} title="Calend√°rio"><Icon name="calendar" className="w-6 h-6" /></button>
                            <button onClick={()=>setActiveView('mindmap')} className={`p-3 rounded-xl transition-all ${activeView==='mindmap' ? 'bg-blue-600 text-white shadow-lg' : 'text-slate-400 hover:text-white hover:bg-slate-800'}`} title="Whiteboard"><Icon name="presentation" className="w-6 h-6" /></button>
                            <button onClick={()=>setActiveView('workflow')} className={`p-3 rounded-xl transition-all ${activeView==='workflow' ? 'bg-gradient-to-br from-yellow-400 to-orange-500 text-white shadow-lg' : 'text-slate-400 hover:text-white hover:bg-slate-800'}`} title="VSL AI"><Icon name="wand-2" className="w-6 h-6" /></button>
                        </nav>
                        <div className="mt-auto">
                            <div className="w-12 h-12 rounded-full bg-slate-700 overflow-hidden border-2 border-slate-600 hover:border-blue-500 transition-colors cursor-pointer"><img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="User" className="w-full h-full object-cover" /></div>
                        </div>
                    </aside>

                    {/* MAIN CONTENT */}
                    <main className="flex-1 relative overflow-hidden flex flex-col">
                        {/* HEADER (COM FILTROS REINSTAURADOS) */}
                        <header className="h-20 border-b border-slate-800 flex items-center justify-between px-8 bg-slate-900/50 backdrop-blur-sm shadow-lg z-40 shrink-0">
                            <div>
                                <h1 className="text-2xl font-bold text-white capitalize flex items-center gap-3">
                                    {activeView === 'workflow' && <span className="text-3xl">üé¨</span>}
                                    {activeView === 'workflow' ? 'AI Factory' : activeView === 'mindmap' ? 'Whiteboard' : activeView === 'kanban' ? 'Kanban Board' : 'Calend√°rio'}
                                </h1>
                                <p className="text-sm text-slate-400 mt-1 flex gap-2 items-center">
                                    <span className={`w-2 h-2 rounded-full ${statusColor === 'text-green-400' ? 'bg-green-500' : 'bg-yellow-500'} animate-pulse`}></span>
                                    {statusMsg}
                                </p>
                            </div>

                            {/* FILTROS (S√≥ mostra em Kanban/Calendar) */}
                            {(activeView === 'kanban' || activeView === 'calendar') && (
                                <div className="flex gap-3 items-center">
                                    <div className="flex items-center gap-2 bg-slate-800/80 p-1 rounded-lg border border-slate-700">
                                        <div className="flex items-center px-2 border-r border-slate-700"><Icon name="filter" className="w-4 h-4 text-slate-400"/></div>
                                        <select value={filterExpert} onChange={e=>setFilterExpert(e.target.value)} className="bg-transparent text-sm text-white outline-none w-24 p-2 cursor-pointer"><option value="">Experts</option>{experts.map(e=><option key={e} value={e}>{e}</option>)}</select>
                                        <select value={filterType} onChange={e=>setFilterType(e.target.value)} className="bg-transparent text-sm text-white outline-none w-24 p-2 cursor-pointer"><option value="">Tipos</option>{Object.entries(TYPES).map(([k,v])=><option key={k} value={k}>{v.label}</option>)}</select>
                                        {(filterExpert || filterType) && <button onClick={()=>{setFilterExpert('');setFilterType('')}} className="p-2 text-red-400 hover:text-white"><Icon name="x" className="w-3 h-3"/></button>}
                                    </div>
                                    <button onClick={()=>setIsPacksModalOpen(true)} className="btn-primary text-white px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 shadow-lg"><Icon name="package" className="w-4 h-4" /> Packs</button>
                                    <button onClick={() => setShowNewTaskModal(true)} className="bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 shadow-lg"><Icon name="plus" className="w-4 h-4" /> Nova</button>
                                </div>
                            )}
                        </header>

                        {/* CONTENT AREA */}
                        <div className="flex-1 overflow-hidden relative p-0 bg-slate-900">
                            {activeView === 'kanban' && <KanbanView tasks={filteredTasks} onTaskClick={setSelectedTask} onDropTask={handleDropTask} columnSearchTexts={columnSearchTexts} setColumnSearchTexts={setColumnSearchTexts} />}
                            {activeView === 'calendar' && <CalendarView tasks={filteredTasks} onTaskClick={setSelectedTask} onDateClick={(date) => { setShowNewTaskModal(true); /* Pr√©-preencher data se poss√≠vel */ }} />}
                            {activeView === 'mindmap' && <MindMapView />}
                            {activeView === 'workflow' && <WorkflowView />}
                        </div>
                    </main>

                    {/* MODALS */}
                    {(showNewTaskModal || selectedTask) && (
                        <TaskModal 
                            onClose={() => { setShowNewTaskModal(false); setSelectedTask(null); }} 
                            task={selectedTask} 
                            experts={experts} 
                            onSave={handleSaveTask}
                            onDelete={selectedTask ? handleDeleteTask : null}
                        />
                    )}
                    
                    {isPacksModalOpen && (
                        <div className="fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4" onClick={() => setIsPacksModalOpen(false)}>
                            <div className="bg-slate-900 border border-slate-700 w-full max-w-4xl rounded-2xl shadow-2xl p-6 max-h-[85vh] overflow-y-auto" onClick={e => e.stopPropagation()}>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-xl font-bold text-white flex gap-2"><Icon name="package" className="w-6 h-6 text-purple-400"/> Packs 4K</h2>
                                    <button onClick={() => setIsPacksModalOpen(false)}><Icon name="x" className="w-6 h-6 text-slate-400"/></button>
                                </div>
                                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                    {VIDEO_PACKS.map((pack, i) => (
                                        <a key={i} href={pack.url} target="_blank" className="bg-slate-800 p-4 rounded-xl border border-slate-700 hover:border-purple-500 flex flex-col items-center gap-2 text-center group">
                                            <div className="w-10 h-10 bg-purple-500/20 rounded-full flex items-center justify-center text-purple-400 group-hover:bg-purple-500 group-hover:text-white transition"><Icon name={pack.icon} className="w-5 h-5"/></div>
                                            <span className="font-bold text-sm text-white">{pack.name}</span>
                                            <span className="text-[10px] text-slate-500">Abrir Drive ‚Üó</span>
                                        </a>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>